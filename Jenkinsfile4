// Simple pipeline
pipeline {

    agent none

    stages {

        // In Stage One add one value to the property and call a library step with it
        stage('One') {
            steps {
                script {
                    // Add a value to the property
                    props.setProperty('PROP_1', 'VAL_1')

                    // Call a custom library step with the properties containing 1 value
                    doWithProperties(props)

                    // Echo it
                    echo "props = ${props.toString()}"
                }

            }
        }

        // In Stage Two add another value to the property and call a library step with it, it should have 2 values
        stage('Two') {
            steps {
                script {
                    // Add a value to the property
                    props.setProperty('PROP_2', 'VAL_2')

                    // Call a custom library step with the properties containing 2 values
                    doWithProperties(props)

                    // Echo it
                    echo "props = ${props.toString()}"
                }
            }
        }
    }
}
